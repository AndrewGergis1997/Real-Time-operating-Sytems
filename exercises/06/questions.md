# Exercise 06 - Q&A

## 1. What is the goal of this exercise? What did you accomplish?
The goal of this exercise is to get familiar with the devicetree, probe and platform drivers.

## 2. What is a platform device? What makes such a device different from, e.g., a USB device or a PCI device?
Platform devices are directly mapped to memory compared to PCI and/or USB which are connected through buses.

## 3. What is the relation between the device-tree and platform device drivers?
The device tree contains all the information that the OS may need for a given device and can be read at runtime in order to initialize the driver for the device correctly.

## 4. Why did we bother to rewrite the LKM code to implement a platform device driver?
In order to avoid using hardcoded addresses and magic numbers.

## 5. Imagine you are developing a product on the PYNQ-Z1 board involving several IP blocks of your own design to squeeze all the resources and cabalities of the SoC FPGA; most IP blocks are accessible from the PS through the AMBA/AXI bus. Do you need to alter the device-tree we are using? What's the minimum set of information that you would require for each addressable IP block?
For every IP block we would like to add, if we want it to be accessible from the OS we have to add a devicetree entry. The basic information needed is the compatible field, the position in memory that it is mapped and any interrupts it may generate.

## 6. What capabilities are exposed through the current sysfs interface of the `irqgen`? Describe the available entry points inside `/sys/kernel/irqgen` and their functions.
root@pynq:/sys/kernel/irqgen# ls -al
drwxr-xr-x	Nov  8 20:12 .
drwxr-xr-x	Jan  1  1970 ..
--w-------	Nov  8 20:13 amount					Sets the amount of interrupts to be generated
-r--r--r--	Nov  8 20:13 count_register			Reads the register that holds the amount of IRQs generated by the IP block (since last power-on)
--w-------	Nov  8 20:13 delay					Sets the delay affter which the interrupt will be generated
-rw-r--r--	Nov  8 20:13 enabled				Enables/disables the IP block
-r--r--r--	Nov  8 20:13 intr_acks				Shows the ack values
-r--r--r--	Nov  8 20:13 intr_handled			Shows the total amount of handled interrupts per interrupt ID
-r--r--r--	Nov  8 20:13 intr_ids				Shows the ids of the interrupt lines
-r--r--r--	Nov  8 20:13 intr_idx				Shows the indices of the interrupt lines
-r--r--r--	Nov  8 20:13 latencies				Shows the latencies of the last 200 generated IRQs
-r--r--r--	Nov  8 20:13 latency				Shows the latecny of the last generated IRQ
--w-------	Nov  8 20:13 line					Changes the line that the IRQs will be generated
-r--r--r--	Nov  8 20:13 line_count				Number of registered IRQ lines
-r--r--r--	Nov  8 20:13 total_handled			Shows the number of handled interrupts since module loading
Above are listed all the sysfs attributes.

## 7. Are there code sections that are missing concurrency barriers? Where? Can you think of a way of triggering unintended behaviour?
Yes, as per the Linux specification the probe method should be reentrant.

## 8. Feedback (what was difficult? what was easy? how would you improve it?)
It was not difficult but it was not very educational either.

